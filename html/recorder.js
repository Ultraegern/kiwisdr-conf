"use strict";const e="/api",t=3e7;let n=!1,o=!1;function a(){const e=document.getElementById("typeSelect").value,a=document.getElementById("zoomInput"),s=parseInt(a.value,10),i=1e3*parseFloat(document.getElementById("freqInput").value),l=document.getElementById("bandwidthLine"),m=document.getElementById("minFreqLine"),c=document.getElementById("maxFreqLine"),u=document.getElementById("zoomWarning"),g=document.getElementById("startBtn"),{bandwidth:_,selection_freq_min:y,selection_freq_max:p,zoom_invalid:h,error_messages:f}=function(e,n,o){let a=0,s=0,i=0,l=!1,m=[];const{nr_valid:c,nr_error_messages:u}=r(e,"Frequency");if(m.push(...u),!c)return{bandwidth:0,selection_freq_min:0,selection_freq_max:0,freq_range_invalid:null,zoom_invalid:!1,error_messages:m};if("png"==o){const{zoom_valid:e,zoom_error_messages:t}=function(e){let t=!0,n=[];const{nr_valid:o,nr_error_messages:a}=r(e,"Zoom");return n.push(...a),o?e<0?(n.push(`Zoom is too low: ${e}. Minimum is 0.`),t=!1):e>14&&(n.push(`Zoom is too high: ${e}. Maximum is 14.`),t=!1):t=!1,{zoom_valid:t,zoom_error_messages:n}}(n);if(m.push(...t),!e)return{bandwidth:0,selection_freq_min:0,selection_freq_max:0,freq_range_invalid:null,zoom_invalid:!0,error_messages:m};a=3e7/Math.pow(2,n)}else{if("iq"!=o)return m.push(`Invalid type: ${o}`),{bandwidth:0,selection_freq_min:0,selection_freq_max:0,freq_range_invalid:null,zoom_invalid:!1,error_messages:m};a=12e3}return i=e+a/2,s=e-a/2,i>t&&(m.push("Frequency range exceeds MAX_FREQ "+d(t)+". Selected max = "+d(i)),l=!0),s<0&&(m.push("Frequency range below MIN_FREQ "+d(0)+". Selected min = "+d(s)),l=!0),{bandwidth:a,selection_freq_min:s,selection_freq_max:i,freq_range_invalid:l,zoom_invalid:!1,error_messages:m}}(i,s,e);f.length>0?(u.style.display="block",u.innerHTML=f.join("<br><br>"),o=!0,g.disabled=n||o):(u.style.display="none",o=!1,g.disabled=n||o),h?(l.textContent="Bandwidth: --",m.textContent="Min: --",c.textContent="Max: --"):(l.textContent="Bandwidth: "+d(_),m.textContent="Min: "+d(y),c.textContent="Max: "+d(p))}function r(e,t){let n=!0,o=[];return isNaN(e)&&(o.push(t+" is not a number."),n=!1),{nr_valid:n,nr_error_messages:o}}function d(e){return Math.abs(e)<1e3?`${e.toFixed(0)} Hz`:Math.abs(e)>=1e3&&Math.abs(e)<1e6?`${(e/1e3).toFixed(1)} kHz`:`${(e/1e6).toFixed(1)} MHz`}async function s(){try{const t=await fetch(`${e}/recorder/status`),a=await t.json(),r=document.getElementById("recorderStatus"),d=document.getElementById("startedAt"),s=document.getElementById("logsContainer"),i=document.getElementById("logTableBody");if(n=a.recording(document.getElementById("startBtn")).disabled=n||o,document.getElementById("stopBtn").disabled=!n,a.recording?(r.textContent="Recording",r.style.color="var(--accent-color)"):(r.textContent="Not Recording",r.style.color="var(--text-color-muted)"),a.started_at){const e=new Date(1e3*a.started_at);d.textContent=`Started at: ${e.toLocaleString(void 0,{hour12:!1})}`}else d.textContent="Started at: --/--/--, --:--:--";if(a.last_logs&&a.last_logs.length>0){s.style.display="flex",i.innerHTML="";for(const e of a.last_logs){const t=document.createElement("tr"),n=document.createElement("td"),o=e.timestamp.toLocaleString(void 0,{hour12:!1});n.textContent=o,t.appendChild(n);const a=document.createElement("td");a.textContent=e.data,t.appendChild(a),i.appendChild(t)}}else s.style.display="none"}catch(e){console.error("Failed to fetch recorder status:",e)}}s(),setInterval(s,1e3),document.getElementById("freqInput").addEventListener("input",a),document.getElementById("zoomInput").addEventListener("input",a),document.getElementById("typeSelect").addEventListener("change",a),a(),window.startRecording=async function(){const t=document.getElementById("typeSelect").value,n=parseFloat(document.getElementById("freqInput").value),o=Math.round(1e3*n),a=parseInt(document.getElementById("zoomInput").value,10),r={rec_type:t,frequency:o,autostop:parseInt(document.getElementById("autostopInput").value,10)||0,zoom:a};try{const t=await fetch(`${e}/recorder/start`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)}),n=await t.json();document.getElementById("messageBox").textContent=n.message,await s()}catch(e){document.getElementById("messageBox").textContent="Failed to start recorder."}},window.stopRecording=async function(){try{const t=await fetch(`${e}/recorder/stop`,{method:"POST"}),n=await t.json();document.getElementById("messageBox").textContent=n.message,await s()}catch(e){document.getElementById("messageBox").textContent="Failed to stop recorder."}},window.handleTypeChange=function(){const e=document.getElementById("typeSelect").value;document.getElementById("zoomInput").disabled="png"!==e};