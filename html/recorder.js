"use strict";const e=3e7;let t=!1,n=!1;function o(){const o=document.getElementById("typeSelect").value,s=document.getElementById("zoomInput"),a=parseInt(s.value,10),i=1e3*parseFloat(document.getElementById("freqInput").value),l=document.getElementById("bandwidthLine"),m=document.getElementById("minFreqLine"),c=document.getElementById("maxFreqLine"),u=document.getElementById("zoomWarning"),_=document.getElementById("startBtn"),{bandwidth:g,selection_freq_min:y,selection_freq_max:f,zoom_invalid:p,error_messages:h}=function(t,n,o){let s=0,a=0,i=0,l=!1,m=[];const{nr_valid:c,nr_error_messages:u}=r(t,"Frequency");if(m.push(...u),!c)return{bandwidth:0,selection_freq_min:0,selection_freq_max:0,freq_range_invalid:null,zoom_invalid:!1,error_messages:m};if("png"==o){const{zoom_valid:e,zoom_error_messages:t}=function(e){let t=!0,n=[];const{nr_valid:o,nr_error_messages:d}=r(e,"Zoom");return n.push(...d),o?e<0?(n.push(`Zoom is too low: ${e}. Minimum is 0.`),t=!1):e>14&&(n.push(`Zoom is too high: ${e}. Maximum is 14.`),t=!1):t=!1,{zoom_valid:t,zoom_error_messages:n}}(n);if(m.push(...t),!e)return{bandwidth:0,selection_freq_min:0,selection_freq_max:0,freq_range_invalid:null,zoom_invalid:!0,error_messages:m};s=3e7/Math.pow(2,n)}else{if("iq"!=o)return m.push(`Invalid type: ${o}`),{bandwidth:0,selection_freq_min:0,selection_freq_max:0,freq_range_invalid:null,zoom_invalid:!1,error_messages:m};s=12e3}return i=t+s/2,a=t-s/2,i>e&&(m.push("Frequency range exceeds MAX_FREQ "+d(e)+". Selected max = "+d(i)),l=!0),a<0&&(m.push("Frequency range below MIN_FREQ "+d(0)+". Selected min = "+d(a)),l=!0),{bandwidth:s,selection_freq_min:a,selection_freq_max:i,freq_range_invalid:l,zoom_invalid:!1,error_messages:m}}(i,a,o);h.length>0?(u.style.display="block",u.innerHTML=h.join("<br><br>"),n=!0,_.disabled=t||n):(u.style.display="none",n=!1,_.disabled=t||n),p?(l.textContent="Bandwidth: --",m.textContent="Min: --",c.textContent="Max: --"):(l.textContent="Bandwidth: "+d(g),m.textContent="Min: "+d(y),c.textContent="Max: "+d(f))}function r(e,t){let n=!0,o=[];return isNaN(e)&&(o.push(t+" is not a number."),n=!1),{nr_valid:n,nr_error_messages:o}}function d(e){return Math.abs(e)<1e3?`${e.toFixed(0)} Hz`:Math.abs(e)>=1e3&&Math.abs(e)<1e6?`${(e/1e3).toFixed(1)} kHz`:`${(e/1e6).toFixed(1)} MHz`}async function s(){try{const e=await fetch("/api/recorder/status"),o=await e.json(),r=document.getElementById("recorderStatus"),d=document.getElementById("startedAt"),s=document.getElementById("logsContainer"),a=document.getElementById("logTableBody");if(t=o.recording,o.recording?(r.textContent="Recording",r.style.color="var(--accent-color)",document.getElementById("startBtn").disabled=t||n,document.getElementById("stopBtn").disabled=!1):(r.textContent="Not Recording",r.style.color="var(--text-color-muted)",document.getElementById("startBtn").disabled=t||n,document.getElementById("stopBtn").disabled=!0),o.started_at){const e=new Date(1e3*o.started_at);d.textContent=`Started at: ${e.toLocaleString(void 0,{hour12:!1})}`}else d.textContent="Started at: --/--/--, --:--:--";if(o.last_logs&&o.last_logs.length>0){s.style.display="flex",a.innerHTML="";for(const e of o.last_logs){const t=document.createElement("tr"),n=document.createElement("td");n.textContent=e,t.appendChild(n),a.appendChild(t)}}else s.style.display="none"}catch(e){console.error("Failed to fetch recorder status:",e)}}s(),setInterval(s,1e3),document.getElementById("freqInput").addEventListener("input",o),document.getElementById("zoomInput").addEventListener("input",o),document.getElementById("typeSelect").addEventListener("change",o),o();