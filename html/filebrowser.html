<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>SDR Recordings Browser</title>
  <link rel="stylesheet" href="/stylesheet.css">
</head>
<body>
	<div class="background"></div>
	<h1>KiwiFiles</h1>
	<p>Browse and download your recordings below:</p>

	<div class="grid" id="file-grid"></div>

	<script>
		const DOWNLOAD_URL = '/recorder/download/';

		async function fetchFileList() {
			try {
				const res = await fetch(DOWNLOAD_URL);
				const text = await res.text();
				const parser = new DOMParser();
				const doc = parser.parseFromString(text, 'text/html');
				
				const links = [...doc.querySelectorAll('a')]
					.filter(a => a.getAttribute('href') && !a.getAttribute('href').startsWith('?') && a.getAttribute('href') !== '../');

				const grid = document.getElementById('file-grid');

				if (!links.length) {
					grid.innerHTML = "<p>No recordings found.</p>";
					return;
				}

				links.forEach(link => {
					const fileName = link.textContent.trim();
					const fileUrl = DOWNLOAD_URL + encodeURIComponent(fileName);

					const card = document.createElement('a');
					card.className = 'card';
					card.href = fileUrl;
					card.target = '_blank';

					const cardMedia = document.createElement('div');
					cardMedia.className = 'card-media';
					cardMedia.style.backgroundImage = 'url(/media/kiwisdr.png)';

					const cardTitle = document.createElement('div');
					cardTitle.className = 'card-title';
					cardTitle.textContent = fileName;

					const cardBody = document.createElement('div');
					cardBody.className = 'card-body';
					cardBody.textContent = 'Click to download';

					card.appendChild(cardMedia);
					card.appendChild(cardTitle);
					card.appendChild(cardBody);
					grid.appendChild(card);
				});
			} catch (err) {
				document.getElementById('file-grid').innerHTML = `<p>Error loading files: ${err.message}</p>`;
			}
		}

		fetchFileList();
	</script>
</body>
</html>